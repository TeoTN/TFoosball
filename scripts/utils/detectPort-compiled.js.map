{"version":3,"sources":["detectPort.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;AAmBA;;AAEA,IAAI,MAAM,QAAQ,KAAR,CAAV;;AAEA,IAAI,SAAS,SAAT,MAAS,CAAS,IAAT,EAAe;AAC1B,MAAI,UAAU,OAAO,QAAP,GAAkB,OAAO,QAAP,CAAgB,OAAlC,GAA4C,EAA1D;;AAEA,MAAI,QAAQ,OAAZ,EAAqB;AACnB,YAAQ,GAAR,CAAY,sBAAZ,EAAoC,IAApC;AACD;AACF,CAND;;AAQA,SAAS,MAAT,CAAgB,IAAhB,EAAsB,EAAtB,EAA0B;;AAExB,MAAI,UAAU,SAAV,OAAU,CAAS,IAAT,EAAe;AAC3B,WAAO,IAAI,OAAJ,CAAY,UAAS,OAAT,EAAkB,MAAlB,EAA0B;AAC3C,UAAI,SAAS,IAAI,IAAI,MAAR,EAAb;AACA,aAAO,IAAP,CAAY,OAAZ,EAAqB,YAAW;AAC9B,eAAO,kBAAP,CAA0B,SAA1B;AACA,eAAO,kBAAP,CAA0B,OAA1B;AACA,eAAO,GAAP;AACA,eAAO,OAAP;AACA,eAAO,KAAP;AACA,YAAI,SAAS,IAAI,IAAI,MAAR,EAAb;AACA,eAAO,EAAP,CAAU,OAAV,EAAmB,YAAW;AAC5B,iBAAO,IAAP;AACA;AACA,kBAAQ,QAAQ,IAAR,CAAR;AACD,SAJD;;AAMA,eAAO,MAAP,CAAc,IAAd,EAAoB,YAAW;AAC7B,iBAAO,IAAP,CAAY,OAAZ,EAAqB,YAAW;AAC9B,oBAAQ,IAAR;AACD,WAFD;AAGA,iBAAO,KAAP;AACD,SALD;AAMD,OAnBD;AAoBA,aAAO,IAAP,CAAY,SAAZ,EAAuB,YAAW;AAChC,eAAO,IAAP;AACA;AACA,gBAAQ,QAAQ,IAAR,CAAR;AACA,eAAO,kBAAP,CAA0B,SAA1B;AACA,eAAO,kBAAP,CAA0B,OAA1B;AACA,eAAO,GAAP;AACA,eAAO,OAAP;AACA,eAAO,KAAP;AACD,OATD;AAUA,aAAO,OAAP,CAAe;AACb,cAAM;AADO,OAAf;AAGD,KAnCM,CAAP;AAoCD,GArCD;;AAuCA,MAAI,kBAAkB,SAAlB,eAAkB,CAAS,GAAT,EAAc;AAClC,YAAQ,IAAR,EACG,IADH,CACQ,UAAS,MAAT,EAAiB;AACrB,UAAI,IAAJ,EAAU,MAAV;AACD,KAHH,EAIG,KAJH,CAIS,UAAS,CAAT,EAAY;AACjB,UAAI,CAAJ;AACD,KANH;AAOD,GARD;;AAUA,SAAO,KAAK,gBAAgB,EAAhB,CAAL,GAA2B,QAAQ,IAAR,CAAlC;AACD;;AAED,OAAO,OAAP,GAAiB,MAAjB","file":"detectPort-compiled.js","sourcesContent":["/* ================================================================\n * detect-port by xdf(xudafeng[at]126.com)\n *\n * first created at : Tue Mar 17 2015 00:16:10 GMT+0800 (CST)\n *\n * ================================================================\n * Copyright xdf\n *\n * Licensed under the MIT License\n * You may not use this file except in compliance with the License.\n *\n * ================================================================ */\n\n// We are forking this temporarily to resolve\n// https://github.com/facebookincubator/create-react-app/issues/302.\n\n// We can replace this fork with `detect-port` package when this is merged:\n// https://github.com/xudafeng/detect-port/pull/4.\n\n'use strict';\n\nvar net = require('net');\n\nvar inject = function(port) {\n  var options = global.__detect ? global.__detect.options : {};\n\n  if (options.verbose) {\n    console.log('port %d was occupied', port);\n  }\n};\n\nfunction detect(port, fn) {\n\n  var _detect = function(port) {\n    return new Promise(function(resolve, reject) {\n      var socket = new net.Socket();\n      socket.once('error', function() {\n        socket.removeAllListeners('connect');\n        socket.removeAllListeners('error');\n        socket.end();\n        socket.destroy();\n        socket.unref();\n        var server = new net.Server();\n        server.on('error', function() {\n          inject(port);\n          port++;\n          resolve(_detect(port));\n        });\n\n        server.listen(port, function() {\n          server.once('close', function() {\n            resolve(port);\n          });\n          server.close();\n        });\n      });\n      socket.once('connect', function() {\n        inject(port);\n        port++;\n        resolve(_detect(port));\n        socket.removeAllListeners('connect');\n        socket.removeAllListeners('error');\n        socket.end();\n        socket.destroy();\n        socket.unref();\n      });\n      socket.connect({\n        port: port\n      });\n    });\n  }\n\n  var _detect_with_cb = function(_fn) {\n    _detect(port)\n      .then(function(result) {\n        _fn(null, result);\n      })\n      .catch(function(e) {\n        _fn(e);\n      });\n  };\n\n  return fn ? _detect_with_cb(fn) : _detect(port);\n}\n\nmodule.exports = detect;\n"]}